@using HsqvLogistica.Models.DTOs.Dashboard
@using MudBlazor

<MudPaper Elevation="3"
          Class="pa-6"
          Style="background: linear-gradient(135deg, #f8f9fc, #ffffff); border-radius: 14px;">

    <!-- HEADER -->
    <div class="d-flex align-center mb-4">
        <MudAvatar Color="Color.Primary"
                   Variant="Variant.Filled"
                   Size="Size.Medium"
                   Class="mr-3">
            <MudIcon Icon="@Icons.Material.Filled.BarChart" />
        </MudAvatar>

        <div>
            <MudText Typo="Typo.h6">Movimientos Mensuales</MudText>
            <MudText Typo="Typo.caption">Últimos 6 meses</MudText>
        </div>
    </div>

    <!-- CONTENT -->
    @if (Movimientos == null || !Movimientos.Any())
    {
        <MudText Color="Color.Secondary">
            No hay información para mostrar
        </MudText>
    }
    else
    {
        <MudChart ChartType="ChartType.Bar"
                  Labels="@_labels"
                  Data="@_data"
                  Height="320px"
                  Class="mt-2" />
    }

</MudPaper>

@code {

    [Parameter]
    public List<MonthlyMovementDto> Movimientos { get; set; } = new();

    private string[] _labels = Array.Empty<string>();
    private double[][] _data = Array.Empty<double[]>();

    protected override void OnParametersSet()
    {
        if (Movimientos == null || !Movimientos.Any())
            return;

        // Eje X
        _labels = Movimientos
            .Select(x => x.Mes)
            .ToArray();

        // Serie de datos
        _data = new[]
        {
            Movimientos
                .Select(x => (double)x.Total)
                .ToArray()
        };
    }
}